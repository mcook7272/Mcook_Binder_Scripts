WITH COH AS (
SELECT DISTINCT Pt.PAT_ID
FROM CLARITY..PATIENT Pt
INNER JOIN CLARITY..IDENTITY_ID II ON II.PAT_ID = PT.PAT_ID and II.IDENTITY_TYPE_ID = 0
WHERE II.IDENTITY_ID in ('E108110218','E106674737','E100701406','E100851794','E104208313')
)

,ENC AS (
SELECT DISTINCT enc.PAT_ID, enc.PAT_ENC_CSN_ID
FROM CLARITY..PAT_ENC enc
INNER JOIN CLARITY..CLARITY_DEP dep on enc.DEPARTMENT_ID = dep.DEPARTMENT_ID 
WHERE 
enc.PAT_ENC_CSN_ID in('1252938599','1268730088','1280522831','1284021258','1294355578','1335982905','1345405712','1363111531','1365925147')
--AND enc.ENC_TYPE_C IN ( '1000', '1001', '1003', '1004', '101', '108', '1199', 
--'1200', '1201', '121', '1214', '2', '200', '210', '2100', '2101',
--'2501', '2502', '2508', '2520', '2521', '2522', '2525', '2526', '2529',
--'2531', '50', '62', '76', '81', '91', '20', '55')
AND (dep.SERV_AREA_ID = 11 OR dep.SERV_AREA_ID IS NULL)
AND enc.EFFECTIVE_DATE_DTTM >= '2017-01-01'
),

COMP AS (
SELECT *
FROM CLARITY..CLARITY_COMPONENT
WHERE COMPONENT_ID in ('9400000009','9400000073','9400000066','9400000025','9400000024',
'9400000012','9400000019','9400000016','9400000067','9400000013','9400000005','9400000069',
'9400000006','9400000002','9400000052','9400000051','9400000048','9400000047','9400000009',
'9400000073','9400000066','9400000025','9400000024','9400000012','9400000019','9400000016',
'9400000067','9400000013','9400000005','9400000069','9400000006','9400000002','9400000052',
'9400000051','9400000048','9400000047','9400000009','9400000073','9400000066','9400000025',
'9400000024','9400000012','9400000019','9400000016','9400000067','9400000013','9400000005',
'9400000069','9400000006','9400000002','9400000052','9400000051','9400000048','9400000047',
'9400000009','9400000073','9400000066','9400000025','9400000024','9400000012','9400000019',
'9400000016','9400000067','9400000013','9400000005','9400000069','9400000006','9400000002',
'9400000052','9400000051','9400000048','9400000047','970000195','970000196','970000191',
'970000189','970000190','970000192','970000193','970000194','970000195','970000196','970000191',
'9300000301','970000192','970000194','9300000502','9300000503')
),

PROCS AS (
SELECT *
FROM CLARITY..CLARITY_EAP eap
WHERE eap.proc_id in(
	'101818',
	'102635',
	'160072',
	'187213',
	'122897',
	'127027')
)

Select DISTINCT II.IDENTITY_ID "EMRN"--,eap.proc_name, ord.ORDER_TIME
--INTO Analytics.dbo.CCDA2715_Sharp_Sarcoidosis_PFT
FROM COH 
INNER JOIN CLARITY..PATIENT Pt ON COH.PAT_ID = Pt.PAT_ID
INNER JOIN CLARITY..IDENTITY_ID II ON II.PAT_ID = PT.PAT_ID and II.IDENTITY_TYPE_ID = 0
inner JOIN ENC enc on COH.PAT_ID = enc.PAT_ID
inner join CLARITY..order_proc ord on ENC.PAT_ENC_CSN_ID = ord.PAT_ENC_CSN_ID
--inner join PROCS eap on eap.PROC_ID = ord.PROC_ID
inner join CLARITY..order_results res on ord.ORDER_PROC_ID = res.ORDER_PROC_ID
--inner join COMP cc on cc.COMPONENT_ID = res.COMPONENT_ID

--E106674737 no proc in PROCS


WITH PROCS AS (
SELECT *
FROM CLARITY..CLARITY_EAP eap
WHERE eap.proc_id in(
	'101818',
	'102635',
	'160072',
	'187213',
	'122897',
	'127027')
)
select distinct ord.pat_enc_csn_id
FROM CLARITY..order_proc ord
inner join PROCS eap on eap.PROC_ID = ord.PROC_ID
inner join CLARITY..order_results res on ord.ORDER_PROC_ID = res.ORDER_PROC_ID
WHERE ord.pat_id in ('Z4214076','Z6680656','Z707169','Z8116148','Z857557')


CLARITY..PAT_LIST_INFO
where list_description like '%Sarcoidosis%'

--498169
--499246

select count(*) from CLARITY..PAT_LIST
where list_id = '498169'